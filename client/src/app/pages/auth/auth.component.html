<div class="auth">
  <!-- <h1 class="title">{{ isCodeVerification ? 'Код подтверждения' : 'Авторизация' }}</h1> -->

  <form class="auth-form" [formGroup]="form" (ngSubmit)="onSubmit()">
    @if (apiError) {
      <div class="api-error">
        {{ apiError }}
      </div>
    }

    @if (!isCodeVerification) {
      <div class="auth-input">
        <app-input
          label="Email"
          [control]="form.controls['email']"
          class="auth-input"
          type="email"
          class="app-input"
          placeholder="example@mail.com"
          size="md"
          errorText="Корректный email обязателен"
        ></app-input>

        <app-input
          label="Пароль"
          [control]="form.controls['password']"
          class="auth-input"
          type="password"
          class="app-input"
          placeholder="Введите пароль"
          size="md"
          errorText="Минимум 8 символов"
        ></app-input>

        <app-input
          label="Код приглашения"
          [control]="form.controls['invite']"
          class="auth-input"
          type="text"
          class="app-input"
          placeholder="Введите код приглашения"
          size="md"
          errorText="Нужен код"
        ></app-input>
      </div>
    }

    @if (isCodeVerification) {
      <div class="code-verification">
        <p class="code-instruction">Мы отправили 6-значный код на {{ form.value.email }}</p>

        <app-input
          [control]="form.controls['code']"
          type="text"
          placeholder="Введите 6 цифр"
          size="md"
          maxlength="6"
        ></app-input>

        <div class="resend-code">
          @if (canResendCode) {
            <button class="btn-text" (click)="onAuthRequest()">Отправить код повторно</button>
          } @else {
            <span>Запросить код повторно через {{ remainingTime }} сек</span>
          }
        </div>
      </div>
    }

    <button class="btn btn-primary btn-md" [ngStyle]="{width: '100%'}"[disabled]="form.invalid"> {{ isCodeVerification ? 'Подтвердить' : 'Продолжить' }}</button>
    @if (!isCodeVerification)  { <p class="text-sm">Как получить  <button class="btn btn-text" (click)="openModal()">код приглашения?</button></p> }
  </form>
</div>

<ng-template #modalAuthInfoContent let-data let-close="close" let-onConfirm="onConfirm">
  <app-auth-info-modal
    [onCancel]="close">
  </app-auth-info-modal>
</ng-template>
<app-modal></app-modal>

